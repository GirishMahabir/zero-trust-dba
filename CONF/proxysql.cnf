datadir="/var/lib/proxysql"

admin_variables=
{
	admin_credentials="admin:Pugah6beinier3oNeengaep7aiGhisha;radmin:go0Daeghai5Xai9te1faenaoPiedohsh"
	mysql_ifaces="0.0.0.0:6032"
}

mysql_variables=
{
	threads=4
	max_connections=2048
	default_query_delay=0
	default_query_timeout=36000000
	have_compress=true
	poll_timeout=2000
	interfaces="0.0.0.0:6033"
	default_schema="information_schema"
	stacksize=1048576
	server_version="5.5.30"
	connect_timeout_server=3000
	monitor_username="monitor"
	monitor_password="monPass"
	monitor_history=600000
	monitor_connect_interval=60000
	monitor_ping_interval=10000
	monitor_read_only_interval=1500
	monitor_read_only_timeout=500
	ping_interval_server_msec=120000
	ping_timeout_server=500
	commands_stats=true
	sessions_sort=true
	connect_retries_on_failure=10
}

mysql_servers =
(
    { address="mariadb-master", port=3306, hostgroup=10, max_connections=1000, max_replication_lag=5, use_ssl=1 },
    { address="mariadb-slave", port=3306, hostgroup=20, max_connections=1000, max_replication_lag=5, use_ssl=1 }
)

mysql_query_rules =
(
    // Master server specific queries
    {
        rule_id=100
        active=1
        match_pattern="^SHOW MASTER STATUS"
        destination_hostgroup=10
        apply=1
    },
    {
        rule_id=101
        active=1
        match_pattern="^SHOW BINARY LOGS"
        destination_hostgroup=10
        apply=1
    },
    {
        rule_id=102
        active=1
        match_pattern="^SHOW PROCESSLIST"
        destination_hostgroup=10
        apply=1
    },
    {
        rule_id=103
        active=1
        match_pattern="^BACKUP TABLE"
        destination_hostgroup=10
        apply=1
    },
    {
        rule_id=104
        active=1
        match_pattern="^CREATE USER"
        destination_hostgroup=10
        apply=1
    },
    {
        rule_id=105
        active=1
        match_pattern="^GRANT"
        destination_hostgroup=10
        apply=1
    },
    // Slave server specific queries
    {
        rule_id=200
        active=1
        match_pattern="^SHOW SLAVE STATUS"
        destination_hostgroup=20
        apply=1
    },
    {
        rule_id=201
        active=1
        match_pattern="^SHOW RELAYLOG EVENTS"
        destination_hostgroup=20
        apply=1
    },
    {
        rule_id=202
        active=1
        match_pattern="^START SLAVE"
        destination_hostgroup=20
        apply=1
    },
    {
        rule_id=203
        active=1
        match_pattern="^STOP SLAVE"
        destination_hostgroup=20
        apply=1
    },
    {
        rule_id=204
        active=1
        match_pattern="^CHANGE MASTER TO"
        destination_hostgroup=20
        apply=1
    },
    // Blocking or redirecting all other queries
    {
        rule_id=900
        active=1
        match_pattern=".*"
        destination_hostgroup=100 // dummy hostgroup that does not exist to block all other queries
        apply=1
        error_msg="Query not allowed."
    },
)

mysql_users =
(
    {
        username: "data_ops",
        password: "aer6eethe7aiShe6uoqu4ieTeef6aig3",
        active: 1,
        default_hostgroup: 10, // Directed to the master server for CRUD operations.
        max_connections: 1000
    },
    {
        username: "db_monitor",
        password: "jae9shequ3Kohsoo5mee5oongii2ique",
        active: 1,
        default_hostgroup: 20, // Directed to the slave server for monitoring.
        max_connections: 10
    },
    {
        username: "backup_operator",
        password: "aeng7Ijoj9eeyie8OoThiojeitho8Jie",
        active: 1,
        default_hostgroup: 20, // Directed to the slave server for backups.
        max_connections: 2
    },
    {
        username: "sys_admin",
        password: "goong1eeQuooW0xeungooPheer9raacu",
        active: 1,
        default_hostgroup: 10, // Adjusted to use the master server for admin tasks.
        max_connections: 4
    }
    
)